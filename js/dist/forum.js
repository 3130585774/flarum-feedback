(()=>{var e={n:t=>{var r=t&&t.__esModule?()=>t.default:()=>t;return e.d(r,{a:r}),r},d:(t,r)=>{for(var o in r)e.o(r,o)&&!e.o(t,o)&&Object.defineProperty(t,o,{enumerable:!0,get:r[o]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};(()=>{"use strict";const t=flarum.reg.get("core","common/app");function r(e){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r(e)}function o(e,t,o){return(t=function(e){var t=function(e){if("object"!=r(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var o=t.call(e,"string");if("object"!=r(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==r(t)?t:t+""}(t))in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}e.n(t)().initializers.add("mcaxe-feedback-common",()=>{console.log("[mcaxe/flarum-feedback] Hello, forum and admin!")});const a=flarum.reg.get("core","forum/app");var n=e.n(a);const i=flarum.reg.get("core","common/extend"),l=flarum.reg.get("core","forum/components/IndexPage");var s=e.n(l);const c=flarum.reg.get("core","common/components/Button");var u=e.n(c);const d=flarum.reg.get("core","common/components/Modal");var f=e.n(d);const h=flarum.reg.get("core","common/utils/Stream");var b=e.n(h);class p extends(f()){constructor(){super(...arguments),o(this,"feedbackText",void 0),o(this,"error",void 0)}oninit(e){super.oninit(e),this.feedbackText=b()(""),this.loading=!1,this.error=null}view(){return m("div",{className:`Modal ${this.className()}`,role:"dialog","aria-modal":"true"},m("div",{className:"Modal-content"},m("header",{className:"Modal-header"},m("h3",{className:"Modal-title"},this.title())),this.content(),this.footer()))}className(){return"mcaxe-feedback-modal Modal--small"}title(){return"意见反馈"}content(){return m("div",{className:"Modal-body"},m("textarea",{className:"FormControl",placeholder:"请输入您的意见",value:this.feedbackText(),oninput:e=>this.feedbackText(e.target.value),rows:"20",cols:"50",required:!0,style:{resize:"none"}}),this.error&&m("p",{className:"error"},this.error))}footer(){return m("div",{className:"Modal-footer",style:{display:"flex",gap:"12px"}},m(u(),{className:"Button Button--primary",style:{flex:1},loading:this.loading,onclick:()=>this.submit()},"提交"),m(u(),{className:"Button",style:{flex:1},onclick:()=>this.hide()},"取消"))}submit(){const e=this.feedbackText().trim();e?(this.loading=!0,this.error=null,n().request({method:"POST",url:n().forum.attribute("apiUrl")+"/mcaxe-flarum-feedbacks",body:{feedback:e}}).then(()=>{this.loading=!1,this.hide(),n().alerts.show({type:"success"},"反馈提交成功，谢谢！")}).catch(()=>{this.loading=!1,this.error="提交失败，请稍后重试"})):this.error="反馈内容不能为空"}}n().initializers.add("mcaxe-feedback",()=>{console.log("[mcaxe/flarum-feedback] Hello, forum!"),(0,i.extend)(s().prototype,"view",function(e){const t=m("div",{className:"mcaxe-feedback-button"},m(u(),{className:"Button Button--primary",onclick:()=>n().modal.show(p)},"意见反馈"));Array.isArray(e.children)||(e.children=e.children?[e.children]:[]),e.children.push(t)})})})(),module.exports={}})();
//# sourceMappingURL=forum.js.map